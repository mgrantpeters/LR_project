"Inh_L6_LHX6_GLP1R",
"Inh_L6_SST_NPY"
))) %>%
ggplot() +
geom_point(aes(x = -log10(q), y = CellType, color = MajorCellType, size = fold_change, alpha=q<0.05))+
#scale_x_continuous(limits = c(-0.05,10))+
scale_alpha_discrete(range=c(0.4, 1))+
facet_grid(rows = vars(factor(testList, levels=c("Splicing regulation", "Spliceosome"))))+
theme(text = element_text(size = 7, family="Arial", colour = "black"),
legend.text = element_text(size = "7", family="Arial", colour = "black"),
axis.text = element_text(size = 7, family="Arial", colour = "black"),
axis.line = element_line(colour = "black"),
axis.title = element_text(size = 7, family="Arial", colour = "black"),
axis.text.y = element_text(size = 7, family="Arial", colour = "black"),
axis.text.x = element_text(size = 7, family="Arial", colour = "black", hjust = 1,vjust = 0),
legend.position = "top",
legend.box="vertical")+
theme(plot.margin=grid::unit(c(0.5,0.5,0.5,0.5), "in"))+
geom_vline(xintercept = -log10(0.05), linetype='longdash', size=0.75, colour = "grey")+
xlab("-log10(q)") +
ylab("Cell type") +
coord_flip() + # this is to make  the graph landscape
theme_light() +
viridis::scale_fill_viridis() + ## to make the colour scheme color-blind safe, the parameter option="A" or option="B",etc will change palette
guides(fill = guide_legend(title = "Major Cell Type")) +
theme(axis.line = element_line(colour = "black"),
axis.text = element_text(colour = "black", size = "10"),
axis.text.x = element_text(colour = "black", size = "10", angle=90, hjust=1),
axis.title = element_text(colour = "black", size = "10"),
strip.text = element_text(colour = "black", size = "10"),
legend.text = element_text(colour = "black", size = "10"),
plot.caption = element_text(colour = "black", size = "10"),
plot.title = element_text(colour = "black", size = "10"),
legend.title = element_text(colour = "black", size = "10"),
legend.position = "top",
## This is to plot the two legends in two rows
legend.box="vertical")
ggsave(
filename="../plots/Overview_results_ann2.png",
plot = last_plot(),
device ="png",
scale = 1,
width = 360,
height = 180,
units = c("mm"),
dpi = 300
)
FinalResult %>%
mutate(CellType = factor(CellType, levels=c("Astro_L1_6_FGFR3_ETNPPL",
"Astro_L1_FGFR3_FOS",
"Astro_L1_FGFR3_MT1G",
"Endo_L2_5_CLDN5",
"Micro_L1_6_C1QC",
"Oligo_L4_6_MOBP_COL18A1",
"Oligo_L4_6_OPALIN",
"OPC_L1_6_MYT1",
"Peri_L1_6_MUSTN1",
"VLMC_L1_3_CYP1B1",
"Exc_L2_3_LINC00507_RPL9P17",
"Exc_L2_4_RORB_GRIK1",
"Exc_L3_4_RORB_FOLH1B",
"Exc_L3_4_RORB_PRSS12",
"Exc_L3_4_RORB_RPS3P6",
"Exc_L3_4_RORB_SEMA6D",
"Exc_L3_5_FEZF2_DCN",
"Exc_L3_5_FEZF2_ONECUT1",
"Exc_L3_5_LINC00507_SLN",
"Exc_L3_5_RORB_CD24",
"Exc_L3_5_RORB_CMAHP",
"Exc_L3_5_RORB_HSPB3",
"Exc_L3_5_THEMIS_ELOF1",
"Exc_L3_5_THEMIS_UBE2F",
"Exc_L3_LINC00507_CTXN3",
"Exc_L3_LINC00507_PSRC1",
"Exc_L3_RORB_CARTPT",
"Exc_L3_THEMIS_PLA2G7",
"Exc_L4_5_RORB_AIM2",
"Exc_L4_5_RORB_ASCL1",
"Exc_L4_5_RORB_HNRNPA1P46",
"Exc_L4_5_RORB_LCN15",
"Exc_L4_5_RORB_LINC01474",
"Exc_L4_5_RORB_RPL31P31",
"Exc_L4_6_RORB_HPCA",
"Exc_L4_RORB_BHLHE22",
"Exc_L4_RORB_CACNG5",
"Exc_L4_RORB_CCDC168",
"Exc_L5_6_FEZF2_ANKRD20A1",
"Exc_L5_6_FEZF2_CABP7",
"Exc_L5_6_FEZF2_CYP26B1",
"Exc_L5_6_FEZF2_MYBPHL",
"Exc_L5_6_FEZF2_RSAD2",
"Exc_L5_6_RORB_LINC00320",
"Exc_L5_6_THEMIS_GPR21",
"Exc_L5_6_THEMIS_IL7R",
"Exc_L5_6_THEMIS_OR1J1",
"Exc_L5_6_THEMIS_THTPA",
"Exc_L5_6_THEMIS_TMEM233",
"Exc_L5_FEZF2_DYRK2",
"Exc_L5_FEZF2_MORN2",
"Exc_L5_FEZF2_SCN7A",
"Exc_L5_RORB_LINC01202",
"Exc_L5_RORB_SNHG7",
"Exc_L6_FEZF2_CPZ",
"Exc_L6_FEZF2_ETV4",
"Exc_L6_FEZF2_FAM95C",
"Exc_L6_FEZF2_KRT17",
"Exc_L6_FEZF2_P4HA3",
"Exc_L6_FEZF2_SLITRK6",
"Exc_L6_FEZF2_TBC1D26",
"Exc_L6_FEZF2_TBCC",
"Exc_L6_FEZF2_VWA2",
"Exc_L6_THEMIS_C6orf48",
"Exc_L6_THEMIS_EGR3",
"Exc_L6_THEMIS_LINC00343",
"Inh_L1_2_PAX6_SCGN",
"Inh_L1_2_PVALB_TAC1",
"Inh_L1_2_VIP_PPAPDC1A",
"Inh_L1_2_VIP_RPL41P3",
"Inh_L1_3_PAX6_NABP1",
"Inh_L1_3_PVALB_WFDC2",
"Inh_L1_3_VIP_ACHE",
"Inh_L1_3_VIP_CCDC184",
"Inh_L1_3_VIP_GGH",
"Inh_L1_3_VIP_SSTR1",
"Inh_L1_3_VIP_ZNF322P1",
"Inh_L1_4_LAMP5_DUSP4",
"Inh_L1_4_VIP_CHRNA2",
"Inh_L1_5_VIP_KCNJ2",
"Inh_L1_6_LAMP5_CA13",
"Inh_L1_6_PVALB_SCUBE3",
"Inh_L1_6_VIP_PENK",
"Inh_L1_6_VIP_RCN1",
"Inh_L1_6_VIP_RGS16",
"Inh_L1_ADARB2_ADAM33",
"Inh_L1_ADARB2_DISP2",
"Inh_L1_LAMP5_GGT8P",
"Inh_L1_LAMP5_NDNF",
"Inh_L1_PAX6_CA4",
"Inh_L1_PAX6_GRIP2",
"Inh_L1_SST_CXCL14",
"Inh_L1_VIP_PCDH20",
"Inh_L1_VIP_PRSS8",
"Inh_L1_VIP_SOX11",
"Inh_L1_VIP_TNFAIP8L3",
"Inh_L2_4_PVALB_C8orf4",
"Inh_L2_4_SST_AHR",
"Inh_L2_4_VIP_DSEL",
"Inh_L2_4_VIP_LGI2",
"Inh_L2_5_VIP_TOX2",
"Inh_L2_6_VIP_VIP",
"Inh_L3_4_PVALB_HOMER3",
"Inh_L3_5_SST_MAFB",
"Inh_L3_6_PVALB_MFI2",
"Inh_L3_6_VIP_KCTD13",
"Inh_L3_VIP_CBLN1",
"Inh_L4_5_PVALB_TRIM67",
"Inh_L4_6_SST_MTHFD2P6",
"Inh_L5_6_LAMP5_SFTA3",
"Inh_L5_6_PVALB_FAM150B",
"Inh_L5_6_PVALB_STON2",
"Inh_L5_6_SST_ISOC1",
"Inh_L5_6_SST_KLHL14",
"Inh_L5_6_SST_TH",
"Inh_L5_PVALB_CNTNAP3P2",
"Inh_L6_LAMP5_ANKRD20A11P",
"Inh_L6_LAMP5_C1QL2",
"Inh_L6_LHX6_GLP1R",
"Inh_L6_SST_NPY"
))) %>%
ggplot() +
geom_point(aes(x = -log10(q), y = CellType, color = MajorCellType, size = fold_change, alpha=q<0.05))+
#scale_x_continuous(limits = c(-0.05,10))+
scale_alpha_discrete(range=c(0.4, 1))+
facet_grid(rows = vars(factor(testList, levels=c("Splicing regulation", "Spliceosome"))))+
theme(text = element_text(size = 7, family="Arial", colour = "black"),
legend.text = element_text(size = "7", family="Arial", colour = "black"),
axis.text = element_text(size = 7, family="Arial", colour = "black"),
axis.line = element_line(colour = "black"),
axis.title = element_text(size = 7, family="Arial", colour = "black"),
axis.text.y = element_text(size = 7, family="Arial", colour = "black"),
axis.text.x = element_text(size = 7, family="Arial", colour = "black", hjust = 1,vjust = 0),
legend.position = "top",
legend.box="vertical")+
theme(plot.margin=grid::unit(c(0.5,0.5,0.5,0.5), "in"))+
geom_vline(xintercept = -log10(0.05), linetype='longdash', size=0.75, colour = "grey")+
xlab("-log10(q)") +
ylab("Cell type") +
coord_flip() + # this is to make  the graph landscape
theme_light() +
viridis::scale_fill_viridis() + ## to make the colour scheme color-blind safe, the parameter option="A" or option="B",etc will change palette
guides(fill = guide_legend(title = "Major Cell Type")) +
theme(axis.line = element_line(colour = "black"),
axis.text = element_text(colour = "black", size = "10"),
axis.text.x = element_text(colour = "black", size = "10", angle=90, hjust=1),
axis.title = element_text(colour = "black", size = "10"),
strip.text = element_text(colour = "black", size = "10"),
legend.text = element_text(colour = "black", size = "10"),
plot.caption = element_text(colour = "black", size = "10"),
plot.title = element_text(colour = "black", size = "10"),
legend.title = element_text(colour = "black", size = "10"),
legend.position = "top",
## This is to plot the two legends in two rows
legend.box="vertical")
ggsave(
filename="../plots/Overview_results_ann2.png",
plot = last_plot(),
device ="png",
scale = 1,
width = 330,
height = 180,
units = c("mm"),
dpi = 300
)
ggsave(
filename="../plots/Overview_results_ann2.png",
plot = last_plot(),
device ="png",
scale = 1,
width = 360,
height = 180,
units = c("mm"),
dpi = 300
)
ggsave(
filename="../plots/Overview_results_ann2.png",
plot = last_plot(),
device ="png",
scale = 1,
width = 360,
height = 180,
units = c("mm"),
dpi = 300
)
ggsave(
filename="../plots/Overview_results_ann2.png",
plot = last_plot(),
device ="png",
scale = 1,
width = 400,
height = 180,
units = c("mm"),
dpi = 300
)
FinalResult1 %>%
mutate(CellType = factor(CellType, levels=c("Astrocyte",
"Microglia",
"Oligodendrocyte",
"OPC",
"Vascular_cells",
"GABAergic_LAMP5",
"GABAergic_PAX6",
"GABAergic_PVALB",
"GABAergic_SST",
"GABAergic_VIP",
"Glutamatergic_IT",
"Glutamatergic_L4_IT",
"Glutamatergic_L5_6_IT_Car3",
"Glutamatergic_L5_6_NP",
"Glutamatergic_L5_ET",
"Glutamatergic_L6_CT",
"Glutamatergic_L6b"
))) %>%
ggplot() +
geom_point(aes(x = -log10(q), y = CellType, color = MajorCellType, size = fold_change, alpha=q<0.05))+
#scale_x_continuous(limits = c(-0.05,10))+
scale_alpha_discrete(range=c(0.4, 1))+
facet_grid(rows = vars(factor(testList, levels=c("Splicing regulation", "Spliceosome"))))+
theme(text = element_text(size = 7, family="Arial", colour = "black"),
legend.text = element_text(size = "7", family="Arial", colour = "black"),
axis.text = element_text(size = 7, family="Arial", colour = "black"),
axis.line = element_line(colour = "black"),
axis.title = element_text(size = 7, family="Arial", colour = "black"),
axis.text.y = element_text(size = 7, family="Arial", colour = "black"),
axis.text.x = element_text(size = 7, family="Arial", colour = "black", hjust = 1,vjust = 0),
legend.position = "top",
legend.box="vertical")+
theme(plot.margin=grid::unit(c(0.5,0.5,0.5,0.5), "in"))+
geom_vline(xintercept = -log10(0.05), linetype='longdash', size=0.75, colour = "grey")+
xlab("-log10(q)") +
ylab("Cell type") +
coord_flip() + # this is to make  the graph landscape
theme_light() +
viridis::scale_fill_viridis() + ## to make the colour scheme color-blind safe, the parameter option="A" or option="B",etc will change palette
guides(fill = guide_legend(title = "Major Cell Type")) +
theme(axis.line = element_line(colour = "black"),
axis.text = element_text(colour = "black", size = "10"),
axis.text.x = element_text(colour = "black", size = "10", angle=90, hjust=1),
axis.title = element_text(colour = "black", size = "10"),
strip.text = element_text(colour = "black", size = "10"),
legend.text = element_text(colour = "black", size = "10"),
plot.caption = element_text(colour = "black", size = "10"),
plot.title = element_text(colour = "black", size = "10"),
legend.title = element_text(colour = "black", size = "10"),
legend.position = "top",
## This is to plot the two legends in two rows
legend.box="vertical")
ggsave(
filename="../plots/Overview_results_annot1.pdf",
plot = last_plot(),
device ="pdf",
scale = 1,
width = 200,
height = 175,
units = c("mm"),
dpi = 300
)
FinalResult1 %>%
mutate(CellType = factor(CellType, levels=c("Astrocyte",
"Microglia",
"Oligodendrocyte",
"OPC",
"Vascular_cells",
"GABAergic_LAMP5",
"GABAergic_PAX6",
"GABAergic_PVALB",
"GABAergic_SST",
"GABAergic_VIP",
"Glutamatergic_IT",
"Glutamatergic_L4_IT",
"Glutamatergic_L5_6_IT_Car3",
"Glutamatergic_L5_6_NP",
"Glutamatergic_L5_ET",
"Glutamatergic_L6_CT",
"Glutamatergic_L6b"
))) %>%
ggplot() +
geom_point(aes(x = -log10(q), y = CellType, color = MajorCellType, size = fold_change, alpha=q<0.05))+
#scale_x_continuous(limits = c(-0.05,10))+
scale_alpha_discrete(range=c(0.4, 1))+
facet_grid(rows = vars(factor(testList, levels=c("Splicing regulation", "Spliceosome"))))+
theme(text = element_text(size = 7, family="Arial", colour = "black"),
legend.text = element_text(size = "7", family="Arial", colour = "black"),
axis.text = element_text(size = 7, family="Arial", colour = "black"),
axis.line = element_line(colour = "black"),
axis.title = element_text(size = 7, family="Arial", colour = "black"),
axis.text.y = element_text(size = 7, family="Arial", colour = "black"),
axis.text.x = element_text(size = 7, family="Arial", colour = "black", hjust = 1,vjust = 0),
legend.position = "top",
legend.box="vertical")+
theme(plot.margin=grid::unit(c(0.5,0.5,0.5,0.5), "in"))+
geom_vline(xintercept = -log10(0.05), linetype='longdash', size=0.75, colour = "grey")+
xlab("-log10(q)") +
ylab("Cell type") +
coord_flip() + # this is to make  the graph landscape
theme_light() +
viridis::scale_fill_viridis() + ## to make the colour scheme color-blind safe, the parameter option="A" or option="B",etc will change palette
guides(fill = guide_legend(title = "Major Cell Type")) +
theme(axis.line = element_line(colour = "black"),
axis.text = element_text(colour = "black", size = "10"),
axis.text.x = element_text(colour = "black", size = "10", angle=90, hjust=1),
axis.title = element_text(colour = "black", size = "10"),
strip.text = element_text(colour = "black", size = "10"),
legend.text = element_text(colour = "black", size = "10"),
plot.caption = element_text(colour = "black", size = "10"),
plot.title = element_text(colour = "black", size = "10"),
legend.title = element_text(colour = "black", size = "10"),
legend.position = "top",
## This is to plot the two legends in two rows
legend.box="vertical")
ggsave(
filename="../plots/Overview_results_annot1.pdf",
plot = last_plot(),
device ="pdf",
scale = 1,
width = 200,
height = 175,
units = c("mm"),
dpi = 300
)
data = read.csv("processed_data/psychiatric_gene_clusters.csv")
library("EWCE")
library("biomaRt")
library("ggplot2")
library("grid")
library("dplyr")
set.seed(1234)
setwd("/Users/melis/Documents/GitHub/LR_project/")
load("C:/Users/melis/Downloads/ctd_aibsMultipleCrtxSmrtSeq.rda")  #Load CTD data
n = 10000
data = read.csv("processed_data/psychiatric_gene_clusters.csv")
data
data[data$cluster2129==1.0,]
data[,data$cluster2129==1.0]
data[data$cluster2129==1.0,]
list = data[data$cluster2129==1.0,]$symbol
full_results <- EWCE::bootstrap_enrichment_test(sct_data = ctd,
sctSpecies = "human",
genelistSpecies = "human",
hits = list,
reps = n,                       #Bootstrap repeats set to 10000
annotLevel = 1,                 #Annotation level where 1= major cell types, 2= higher resolution
geneSizeControl = TRUE)         #Control for GC content and gene length
full_results$results$q = p.adjust(full_results$results$p, method = "fdr", n = length(full_results$results$p))
full_results$results$MajorCellType = unlist(lapply(strsplit(as.character(full_results$results$CellType),'_'), `[[`, 1))
FinalResult1 = data.frame(full_results$results)
FinalResult1 %>%
mutate(CellType = factor(CellType, levels=c("Astrocyte",
"Microglia",
"Oligodendrocyte",
"OPC",
"Vascular_cells",
"GABAergic_LAMP5",
"GABAergic_PAX6",
"GABAergic_PVALB",
"GABAergic_SST",
"GABAergic_VIP",
"Glutamatergic_IT",
"Glutamatergic_L4_IT",
"Glutamatergic_L5_6_IT_Car3",
"Glutamatergic_L5_6_NP",
"Glutamatergic_L5_ET",
"Glutamatergic_L6_CT",
"Glutamatergic_L6b"
))) %>%
ggplot() +
geom_point(aes(x = -log10(q), y = CellType, color = MajorCellType, size = fold_change, alpha=q<0.05))+
#scale_x_continuous(limits = c(-0.05,10))+
scale_alpha_discrete(range=c(0.4, 1))+
theme(text = element_text(size = 12))+ theme(plot.margin=grid::unit(c(0.5,0.5,0.5,0.5), "in"))+
geom_vline(xintercept = -log10(0.05), linetype='longdash', size=0.75, colour = "grey")+
xlab("-log10(q)") +
ylab("Cell type") +
coord_flip() + # this is to make  the graph landscape
theme_light() +
viridis::scale_fill_viridis() + ## to make the colour scheme color-blind safe, the parameter option="A" or option="B",etc will change palette
guides(fill = guide_legend(title = "Major Cell Type")) +
theme(axis.line = element_line(colour = "black"),
axis.text = element_text(colour = "black", size = "10"),
axis.text.x = element_text(colour = "black", size = "10", angle=90, hjust=1),
axis.title = element_text(colour = "black", size = "10"),
strip.text = element_text(colour = "black", size = "10"),
legend.text = element_text(colour = "black", size = "10"),
plot.caption = element_text(colour = "black", size = "10"),
plot.title = element_text(colour = "black", size = "10"),
legend.title = element_text(colour = "black", size = "10"),
legend.position = "top",
## This is to plot the two legends in two rows
legend.box="vertical")
ggsave(
filename="plots/04-psychiatric_specificity_GTEx/gene_clusters_cell_type_specificity_aibs.png",
plot = last_plot(),
device ="png",
scale = 1,
width = 16,
height = 14,
units = c("cm"),
dpi = 300
)
list = data[data$cluster0565==69.0,]$symbol
full_results <- EWCE::bootstrap_enrichment_test(sct_data = ctd,
sctSpecies = "human",
genelistSpecies = "human",
hits = list,
reps = n,                       #Bootstrap repeats set to 10000
annotLevel = 1,                 #Annotation level where 1= major cell types, 2= higher resolution
geneSizeControl = TRUE)         #Control for GC content and gene length
full_results$results$q = p.adjust(full_results$results$p, method = "fdr", n = length(full_results$results$p))
full_results$results$MajorCellType = unlist(lapply(strsplit(as.character(full_results$results$CellType),'_'), `[[`, 1))
FinalResult1 = data.frame(full_results$results)
FinalResult1 %>%
mutate(CellType = factor(CellType, levels=c("Astrocyte",
"Microglia",
"Oligodendrocyte",
"OPC",
"Vascular_cells",
"GABAergic_LAMP5",
"GABAergic_PAX6",
"GABAergic_PVALB",
"GABAergic_SST",
"GABAergic_VIP",
"Glutamatergic_IT",
"Glutamatergic_L4_IT",
"Glutamatergic_L5_6_IT_Car3",
"Glutamatergic_L5_6_NP",
"Glutamatergic_L5_ET",
"Glutamatergic_L6_CT",
"Glutamatergic_L6b"
))) %>%
ggplot() +
geom_point(aes(x = -log10(q), y = CellType, color = MajorCellType, size = fold_change, alpha=q<0.05))+
#scale_x_continuous(limits = c(-0.05,10))+
scale_alpha_discrete(range=c(0.4, 1))+
theme(text = element_text(size = 12))+ theme(plot.margin=grid::unit(c(0.5,0.5,0.5,0.5), "in"))+
geom_vline(xintercept = -log10(0.05), linetype='longdash', size=0.75, colour = "grey")+
xlab("-log10(q)") +
ylab("Cell type") +
coord_flip() + # this is to make  the graph landscape
theme_light() +
viridis::scale_fill_viridis() + ## to make the colour scheme color-blind safe, the parameter option="A" or option="B",etc will change palette
guides(fill = guide_legend(title = "Major Cell Type")) +
theme(axis.line = element_line(colour = "black"),
axis.text = element_text(colour = "black", size = "10"),
axis.text.x = element_text(colour = "black", size = "10", angle=90, hjust=1),
axis.title = element_text(colour = "black", size = "10"),
strip.text = element_text(colour = "black", size = "10"),
legend.text = element_text(colour = "black", size = "10"),
plot.caption = element_text(colour = "black", size = "10"),
plot.title = element_text(colour = "black", size = "10"),
legend.title = element_text(colour = "black", size = "10"),
legend.position = "top",
## This is to plot the two legends in two rows
legend.box="vertical")
ggsave(
filename="plots/04-psychiatric_specificity_GTEx/gene_clusters_cluster0565_C69_cell_type_specificity_aibs.png",
plot = last_plot(),
device ="png",
scale = 1,
width = 16,
height = 14,
units = c("cm"),
dpi = 300
)
